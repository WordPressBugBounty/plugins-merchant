"use strict";jQuery(document).ready(function(c){function t(){var t=merchant_side_cart_params.allowed_devices,e=window.innerWidth;return e<=768&&t.includes("mobile")||!!(768<e&&t.includes("desktop"))}var e,a,n,i,s;merchant.setting.hasOwnProperty("show_after_add_to_cart_single_product")&&t()&&(e=c("body.single-product").length,a=c(".woocommerce-notices-wrapper").is(":visible")&&!c(".woocommerce-notices-wrapper").is(":empty"),n=c(".wc-block-components-notice-banner").is(":visible")&&!c(".wc-block-components-notice-banner").is(":empty"),e)&&(a||n)&&(c("body").toggleClass("merchant-floating-side-mini-cart-show"),c(window).trigger("merchant.floating-mini-cart-resize")),merchant.setting.hasOwnProperty("add_to_cart_slide_out")&&t()&&c(document.body).on("added_to_cart",function(t,e,a,n,r){"side-cart"!==r&&c("body").toggleClass("merchant-floating-side-mini-cart-show"),c(window).trigger("merchant.floating-mini-cart-resize")}),merchant.setting.hasOwnProperty("cart_url")&&t()&&c('[href="'+merchant.setting.cart_url+'"]').on("click",function(t){t.preventDefault(),c(window).trigger("merchant.floating-mini-cart-resize"),c("body").toggleClass("merchant-floating-side-mini-cart-show")}),(merchant.setting.hasOwnProperty("add_to_cart_slide_out")||merchant.setting.hasOwnProperty("floating_mini_cart_count"))&&t()&&(i=function(e){var t,a,n,r=merchant.setting||{},o=r.ajax_url,i=r.side_cart_nonce;e.length&&o&&i&&(t=e.attr("name"),a=Math.round(parseFloat(e.val()||1)),n=e.closest(".js-side-cart-item"),clearTimeout(s),s=setTimeout(function(){c.ajax({type:"POST",url:o,data:{action:"update_side_cart_quantity",cart_item_key:t,quantity:a,nonce:i},beforeSend:function(){n.length&&n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(t){t&&t.fragments&&(c(document.body).trigger("added_to_cart",[t.fragments,t.cart_hash,e,"side-cart"]),n.length)&&(n.unblock(),c(document).trigger("merchant_destroy_carousel"),c(document).trigger("merchant_init_carousel"))},error:function(t){console.log("Error:",t)}})},350))},c(document).on("click",".js-merchant-quantity-btn",function(t){t.preventDefault();var e,a,n,r,t=c(this),o=t.closest(".merchant-quantity-wrap").find(".js-update-quantity");o.length&&(e=+(o.val()||1),a=+o.attr("min"),n=+o.attr("max"),r=Math.round(parseFloat(o.attr("step"))),t.hasClass("merchant-quantity-plus")?(e+=r,e=n&&-1!=n?Math.min(e,n):e):t.hasClass("merchant-quantity-minus")&&(e-=r,e=a?Math.max(e,a):e),o.val(e),i(o))}),c(document).on("input change",".js-update-quantity",function(t){t.preventDefault(),i(c(this))})),{init:function(){var t=this;this.bindEvents(),setTimeout(function(){c(document).trigger("merchant_init_carousel"),c(document).find(".woocommerce-mini-cart-item.merchant-upsell-widget").on("mouseenter",function(){c(document).find(".merchant-mini-cart-upsells.upsells-layout-carousel").hasClass("slick-initialized")&&c(".merchant-mini-cart-upsells.upsells-layout-carousel").slick("slickPause")}),c(document).find(".woocommerce-mini-cart-item.merchant-upsell-widget").on("mouseleave",function(){c(document).find(".merchant-mini-cart-upsells.upsells-layout-carousel").hasClass("slick-initialized")&&c(".merchant-mini-cart-upsells.upsells-layout-carousel").slick("slickPlay")}),t.sideCartBtns()},500)},bindEvents:function(){c(document).on("change",".merchant-mini-cart-upsell-item-wrap .variation-selector",this.handleVariationChange.bind(this)),c(document).on("click",".add-to-cart-wrap .merchant-upsell-add-to-cart:not(.disabled)",this.handleAddToCartClick.bind(this)),c(document).on("click",".merchant-coupon-form button",this.handleCouponBtnClick.bind(this)),c(document).on("click",".merchant-remove-coupon",this.handleCouponRemoveClick.bind(this)),c(document).on("merchant_init_carousel",this.initCarousel.bind(this)),c(document).on("merchant_destroy_carousel",this.destroyCarousel.bind(this)),c(document).on("added_to_cart",this.handleAddToCart.bind(this)),c(document).on("removed_from_cart",this.handleRemoveFromCart.bind(this))},handleVariationChange:function(t){var e=c(t.target).closest(".merchant-mini-cart-upsell-item-wrap"),a=e.attr("data-variations")&&JSON.parse(e.attr("data-variations"))||[],n=e.find(".variation-selector"),r=(e.attr("data-variation-id",0),{name:c(t.target).attr("data-attribute_name"),value:c(t.target).val()}),o=[],i=a.filter(function(t){return void 0!==t.attributes[r.name.toLowerCase()]&&t.attributes[r.name.toLowerCase()]===r.value});n.each(function(){var t=c(this),e=t.attr("data-attribute_name");i.forEach(function(t){t=t.attributes[e.toLowerCase()];void 0===t||""===t||o.includes(t)||o.push(t)}),r.name.toLowerCase()!==e.toLowerCase()&&t.find("option").each(function(){var t=c(this).attr("value");""!==t&&(o.includes(t)?c(this).show():c(this).hide())})}),this.isAllVariationsSelected(e)?(this.fetchVariationDetails(e,e.attr("data-product-id"),this.getSelectedAttributes(e),this),this.handleAddToCartBtnState(e,!0)):this.handleAddToCartBtnState(e,!1)},fetchVariationDetails:function(e,t,a,n){c.ajax({type:"POST",url:merchant_side_cart_params.ajax_url,data:{action:"merchant_get_variation_data",product_id:t,nonce:merchant_side_cart_params.variation_info_nonce,attributes:a},success:function(t){t.success&&(console.log(t.data),e.attr("data-variation-id",t.data.id),n.updateProductThumbnail(e,t.data.thumbnail_url))},error:function(t){console.log("Error:",t)}})},updateProductThumbnail:function(t,e){t.find(".product-thumbnail a img").attr("src",e)},getSelectedAttributes:function(t){var e={};return t.find(".variation-selector").each(function(){e[c(this).attr("name")]=c(this).val()}),e},handleAddToCartBtnState:function(t,e){t=t.find(".add-to-cart-wrap .merchant-upsell-add-to-cart");e?(t.removeClass("disabled"),t.prop("disabled",!1)):(t.addClass("disabled"),t.prop("disabled",!0))},isAllVariationsSelected:function(t){t=t.find(".variation-selector");return t.length&&t.toArray().every(function(t){return""!==c(t).val()})},handleAddToCartClick:function(t){t.preventDefault();var t=c(t.currentTarget),e=t.closest(".merchant-mini-cart-upsell-item-wrap"),a=e.attr("data-product-type"),n=e.attr("data-product-id"),e=e.attr("data-variation-id");"variable"===a&&"0"!==e?this.addToCart(this,"variable",n,e,t):"simple"===a?this.addToCart(this,"simple",n,e,t):console.log("Unsupported product type:",a)},addToCart:function(e,t,a,n,r){a={action:"merchant_side_cart_upsells_add_to_cart",product_id:a,variation_id:n,nonce:merchant_side_cart_params.nonce};c.ajax({type:"POST",url:merchant_side_cart_params.ajax_url,data:a,beforeSend:function(){r.addClass("loading")},success:function(t){e.handleSuccess(t)},error:function(t){e.handleError(t)},complete:function(){r.removeClass("loading")}})},handleSuccess:function(t){t.data.fragments&&(c(document).trigger("merchant_destroy_carousel"),c(document.body).trigger("added_to_cart",[t.data.fragments,t.data.cart_hash,null,"side-cart"]),c(document).trigger("merchant_init_carousel"))},handleError:function(t){console.log("Error:",t)},handleAddToCart:function(t,e,a,n,r){c(document).trigger("merchant_destroy_carousel"),c(document).trigger("merchant_init_carousel")},handleRemoveFromCart:function(t){c(document).trigger("merchant_destroy_carousel"),c(document).trigger("merchant_init_carousel")},initCarousel:function(){var t=c(document).find(".merchant-mini-cart-upsells.upsells-layout-carousel");"carousel"!==merchant_side_cart_params.upsells_style||t.hasClass("slick-initialized")||t.slick({infinite:!0,arrows:!0,slidesToShow:1,dots:!1,autoplay:!1,fade:!0,cssEase:"linear",pauseOnFocus:!0,pauseOnHover:!0,prevArrow:'<button type="button" class="slick-prev"><</button>',nextArrow:'<button type="button" class="slick-next">></button>',rtl:"1"===merchant_side_cart_params.is_rtl})},destroyCarousel:function(){var t=c(document).find(".merchant-mini-cart-upsells.upsells-layout-carousel");"carousel"===merchant_side_cart_params.upsells_style&&t.hasClass("slick-initialized")&&t.slick("unslick")},handleCouponBtnClick:function(t){t.preventDefault();var t=c(t.currentTarget).closest(".merchant-coupon-form"),e=t.find(".coupon_code").val();""!==e&&this.applyCoupon(this,e,t)},applyCoupon:function(e,t,a){t={action:"merchant_side_cart_apply_coupon",coupon_code:t,nonce:merchant_side_cart_params.nonce};c.ajax({type:"POST",url:merchant_side_cart_params.ajax_url,data:t,beforeSend:function(){a.addClass("loading")},success:function(t){e.handleCouponSuccess(t)},error:function(t){e.handleCouponError(t)},complete:function(){a.removeClass("loading")}})},removeCoupon:function(e,t){t={action:"merchant_side_cart_remove_coupon",coupon_code:t,nonce:merchant_side_cart_params.nonce};c.ajax({type:"POST",url:merchant_side_cart_params.ajax_url,data:t,beforeSend:function(){},success:function(t){e.handleCouponSuccess(t)},error:function(t){e.handleCouponError(t)}})},handleCouponSuccess:function(t){void 0!==t.fragments&&(c(document).trigger("merchant_destroy_carousel"),c(document.body).trigger("added_to_cart",[t.fragments,t.cart_hash,null,"side-cart"]),c(document).trigger("merchant_init_carousel"))},handleCouponError:function(t){console.log("Error:",t)},handleCouponRemoveClick:function(t){t.preventDefault();var t=c(t.currentTarget),e=t.attr("data-coupon");console.log(t),this.removeCoupon(this,e)},sideCartBtns:function(){var t="1"===merchant_side_cart_params.show_checkout_btn,e="1"===merchant_side_cart_params.show_view_cart_btn,a=merchant_side_cart_params.checkout_btn_text,n=merchant_side_cart_params.view_cart_btn_text,r=c(document).find(".merchant-floating-side-mini-cart-body .woocommerce-mini-cart__buttons"),o=r.find(".checkout"),i=r.find("a:not(.checkout)");t||e?(t||o.hide(),e||i.hide(),""!==a&&o.text(a),""!==n&&i.text(n)):r.hide()}}.init()});