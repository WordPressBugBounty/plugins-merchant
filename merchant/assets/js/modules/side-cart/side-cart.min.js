jQuery(document).ready(function(s){var t,a,e,o,c;merchant.setting.hasOwnProperty("show_after_add_to_cart_single_product")&&(t=s("body.single-product").length,a=s(".woocommerce-notices-wrapper").is(":visible")&&!s(".woocommerce-notices-wrapper").is(":empty"),e=s(".wc-block-components-notice-banner").is(":visible")&&!s(".wc-block-components-notice-banner").is(":empty"),t)&&(a||e)&&(s("body").toggleClass("merchant-floating-side-mini-cart-show"),s(window).trigger("merchant.floating-mini-cart-resize")),merchant.setting.hasOwnProperty("add_to_cart_slide_out")&&s(document.body).on("added_to_cart",function(t,a,e,n,r){"side-cart"!==r&&s("body").toggleClass("merchant-floating-side-mini-cart-show"),s(window).trigger("merchant.floating-mini-cart-resize")}),merchant.setting.hasOwnProperty("cart_url")&&s('[href="'+merchant.setting.cart_url+'"]').on("click",function(t){t.preventDefault(),s(window).trigger("merchant.floating-mini-cart-resize"),s("body").toggleClass("merchant-floating-side-mini-cart-show")}),(merchant.setting.hasOwnProperty("add_to_cart_slide_out")||merchant.setting.hasOwnProperty("floating_mini_cart_count"))&&(o=function(a){var t,e,n,r=merchant.setting||{},i=r.ajax_url,o=r.side_cart_nonce;a.length&&i&&o&&(t=a.attr("name"),e=Math.round(parseFloat(a.val()||1)),n=a.closest(".js-side-cart-item"),clearTimeout(c),c=setTimeout(function(){s.ajax({type:"POST",url:i,data:{action:"update_side_cart_quantity",cart_item_key:t,quantity:e,nonce:o},beforeSend:function(){n.length&&n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(t){t&&t.fragments&&(s(document.body).trigger("added_to_cart",[t.fragments,t.cart_hash,a,"side-cart"]),n.length)&&(n.unblock(),s(document).trigger("merchant_destroy_carousel"),s(document).trigger("merchant_init_carousel"))},error:function(t){console.log("Error:",t)}})},350))},s(document).on("click",".js-merchant-quantity-btn",function(t){t.preventDefault();var a,e,n,r,t=s(this),i=t.closest(".merchant-quantity-wrap").find(".js-update-quantity");i.length&&(a=+(i.val()||1),e=+i.attr("min"),n=+i.attr("max"),r=Math.round(parseFloat(i.attr("step"))),t.hasClass("merchant-quantity-plus")?(a+=r,a=n&&-1!=n?Math.min(a,n):a):t.hasClass("merchant-quantity-minus")&&(a-=r,a=e?Math.max(a,e):a),i.val(a),o(i))}),s(document).on("input change",".js-update-quantity",function(t){t.preventDefault(),o(s(this))})),{init:function(){this.bindEvents(),setTimeout(function(){s(document).trigger("merchant_init_carousel"),s(document).find(".woocommerce-mini-cart-item.merchant-upsell-widget").on("mouseenter",function(){s(document).find(".merchant-mini-cart-upsells.upsells-layout-carousel").hasClass("slick-initialized")&&s(".merchant-mini-cart-upsells.upsells-layout-carousel").slick("slickPause")}),s(document).find(".woocommerce-mini-cart-item.merchant-upsell-widget").on("mouseleave",function(){s(document).find(".merchant-mini-cart-upsells.upsells-layout-carousel").hasClass("slick-initialized")&&s(".merchant-mini-cart-upsells.upsells-layout-carousel").slick("slickPlay")})},500)},bindEvents:function(){s(document).on("change",".merchant-mini-cart-upsell-item-wrap .variation-selector",this.handleVariationChange.bind(this)),s(document).on("click",".add-to-cart-wrap .merchant-upsell-add-to-cart:not(.disabled)",this.handleAddToCartClick.bind(this)),s(document).on("merchant_init_carousel",this.initCarousel.bind(this)),s(document).on("merchant_destroy_carousel",this.destroyCarousel.bind(this)),s(document).on("added_to_cart",this.handleAddToCart.bind(this)),s(document).on("removed_from_cart",this.handleRemoveFromCart.bind(this))},handleVariationChange:function(t){var a=s(t.target).closest(".merchant-mini-cart-upsell-item-wrap"),e=a.attr("data-variations")&&JSON.parse(a.attr("data-variations"))||[],n=a.find(".variation-selector"),r=(a.attr("data-variation-id",0),{name:s(t.target).attr("data-attribute_name"),value:s(t.target).val()}),i=[],o=e.filter(function(t){return void 0!==t.attributes[r.name.toLowerCase()]&&t.attributes[r.name.toLowerCase()]===r.value});n.each(function(){var t=s(this),a=t.attr("data-attribute_name");o.forEach(function(t){t=t.attributes[a.toLowerCase()];void 0===t||""===t||i.includes(t)||i.push(t)}),r.name.toLowerCase()!==a.toLowerCase()&&t.find("option").each(function(){var t=s(this).attr("value");""!==t&&(i.includes(t)?s(this).show():s(this).hide())})}),this.isAllVariationsSelected(a)?(this.fetchVariationDetails(a,a.attr("data-product-id"),this.getSelectedAttributes(a),this),this.handleAddToCartBtnState(a,!0)):this.handleAddToCartBtnState(a,!1)},fetchVariationDetails:function(a,t,e,n){s.ajax({type:"POST",url:merchant_side_cart_params.ajax_url,data:{action:"merchant_get_variation_data",product_id:t,nonce:merchant_side_cart_params.variation_info_nonce,attributes:e},success:function(t){t.success&&(console.log(t.data),a.attr("data-variation-id",t.data.id),n.updateProductThumbnail(a,t.data.thumbnail_url))},error:function(t){console.log("Error:",t)}})},updateProductThumbnail:function(t,a){t.find(".product-thumbnail a img").attr("src",a)},getSelectedAttributes:function(t){var a={};return t.find(".variation-selector").each(function(){a[s(this).attr("name")]=s(this).val()}),a},handleAddToCartBtnState:function(t,a){t=t.find(".add-to-cart-wrap .merchant-upsell-add-to-cart");a?(t.removeClass("disabled"),t.prop("disabled",!1)):(t.addClass("disabled"),t.prop("disabled",!0))},isAllVariationsSelected:function(t){t=t.find(".variation-selector");return t.length&&t.toArray().every(function(t){return""!==s(t).val()})},handleAddToCartClick:function(t){t.preventDefault();var t=s(t.currentTarget),a=t.closest(".merchant-mini-cart-upsell-item-wrap"),e=a.attr("data-product-type"),n=a.attr("data-product-id"),a=a.attr("data-variation-id");"variable"===e&&"0"!==a?this.addToCart(this,"variable",n,a,t):"simple"===e?this.addToCart(this,"simple",n,a,t):console.log("Unsupported product type:",e)},addToCart:function(a,t,e,n,r){e={action:"merchant_side_cart_upsells_add_to_cart",product_id:e,variation_id:n,nonce:merchant_side_cart_params.nonce};s.ajax({type:"POST",url:merchant_side_cart_params.ajax_url,data:e,beforeSend:function(){r.addClass("loading")},success:function(t){a.handleSuccess(t)},error:function(t){a.handleError(t)},complete:function(){r.removeClass("loading")}})},handleSuccess:function(t){t.data.fragments&&(s(document).trigger("merchant_destroy_carousel"),s(document.body).trigger("added_to_cart",[t.data.fragments,t.data.cart_hash,null,"side-cart"]),s(document).trigger("merchant_init_carousel"))},handleError:function(t){console.log("Error:",t)},handleAddToCart:function(t,a,e,n,r){s(document).trigger("merchant_destroy_carousel"),s(document).trigger("merchant_init_carousel")},handleRemoveFromCart:function(t){s(document).trigger("merchant_destroy_carousel"),s(document).trigger("merchant_init_carousel")},initCarousel:function(){var t=s(document).find(".merchant-mini-cart-upsells.upsells-layout-carousel");"carousel"!==merchant_side_cart_params.upsells_style||t.hasClass("slick-initialized")||t.slick({infinite:!0,arrows:!0,slidesToShow:1,dots:!1,autoplay:!1,autoplaySpeed:2e3,fade:!0,cssEase:"linear",pauseOnFocus:!0,pauseOnHover:!0,prevArrow:'<button type="button" class="slick-prev"><</button>',nextArrow:'<button type="button" class="slick-next">></button>',rtl:merchant_side_cart_params.is_rtl})},destroyCarousel:function(){var t=s(document).find(".merchant-mini-cart-upsells.upsells-layout-carousel");"carousel"===merchant_side_cart_params.upsells_style&&t.hasClass("slick-initialized")&&t.slick("unslick")}}.init()});