(d=>{d.fn.merchantMetabox=function(){function l(e){e=e.find(".merchant-metabox-field-select select[multiple]");e.length&&(e.select2({width:"100%"}),e.each(function(){var e=d(this);e.next(".select2-container").find(".select2-selection--multiple").length&&e.next(".select2-container").find(".select2-selection--multiple").append('<span class="merchant-select2-clear"></span>')}))}function c(a){a.each(function(){var e=d(this).find("select"),t=e.data("source"),n=window.merchant_metabox;e.select2({width:"100%",minimumInputLength:1,ajax:{url:n.ajaxurl,dataType:"json",delay:250,cache:!0,data:function(e){return{action:"merchant_select_ajax",nonce:n.ajaxnonce,term:e.term,source:t}},processResults:function(e,t){return e.success?{results:e.data}:{}}}}),a.find(".select2-selection--multiple").append('<span class="merchant-select2-clear"></span>')})}return this.each(function(){var e=d(this),t=e.find(".merchant-metabox-tab"),m=e.find(".merchant-metabox-content"),a=(t.each(function(){var t=d(this);t.on("click",function(e){e.preventDefault();e=m.eq(t.index());t.addClass("active").siblings().removeClass("active"),e.addClass("active").siblings().removeClass("active"),d(document).trigger("merchant-metabox-content-show",e)})}),m.find(".merchant-metabox-field-flexible-content")),n=(a.length&&a.each(function(){var i=".merchant-metabox-field-flexible-content-select-ajax",o=d(i),n=(o.length&&c(o),d(this).find(".merchant-metabox-field-flexible-content-list"));n.sortable({axis:"y",cursor:"move",helper:"original",handle:".merchant-metabox-field-flexible-content-move",stop:function(e,t){n.find("> li").each(function(e){var t=".merchant-metabox-field-flexible-content-item-count",n=d(this).find(t).text(),a=parseInt(n)-1;d(this).find(t).text(e),d(this).find("input, select").each(function(){d(this).attr("name")&&d(this).attr("name",d(this).attr("name").replace("["+a+"]","["+(e-1)+"]"))})})}}),a.find(".merchant-metabox-field-flexible-content-add-button").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),d(this).parent().find(".merchant-metabox-field-flexible-content-add-list").toggleClass("active")}),a.find(".merchant-metabox-field-flexible-content-add").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var e=d(".merchant-metabox-field-flexible-content-list[data-id="+d(this).data("id")+"]"),t=d(this).data("layout"),n=e.find("> li"),a=e.find("> li").first().clone(!0);a.find(" > div").each(function(){d(this).data("layout")!==t||d(this).children().appendTo(d(this).parent()),d(this).remove()}),a.find("input, select").each(function(){d(this).data("name")&&d(this).attr("name",d(this).data("name").replace("0",n.length-1))}),a.find(".merchant-metabox-field-flexible-content-item-count").text(n.length),a.find(".merchant-metabox-field-flexible-content-select-ajax-clone").each(function(){d(this).removeClass("merchant-metabox-field-flexible-content-select-ajax-clone"),d(this).addClass("merchant-metabox-field-flexible-content-select-ajax")}),a.removeClass("hidden"),e.append(a),(o=d(i)).length&&c(o),l(a),d(this).parent().removeClass("active"),e.removeClass("empty")}),a.find(".merchant-metabox-field-flexible-content-remove").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var e=d(this).closest("li"),t=e.parent();e.remove(),1===t.find(">li").length&&t.addClass("empty")})}),m.find(".merchant-metabox-field-repeater, .merchant-metabox-field-flexible-content-repeater")),i=(n.length&&n.each(function(){var a=d(this).find("ul");a.sortable({axis:"y",cursor:"move",helper:"original",handle:".merchant-metabox-field-repeater-move"}),n.find(".merchant-metabox-field-repeater-add").on("click",function(e){e.preventDefault();var t=a.find("li"),e=a.find("li").first().clone(!0),n=e.find("input");e.find(".merchant-metabox-field-repeater-list-item-fields").length?e.find("input").each(function(){d(this).attr("name",d(this).data("name").replace("0",t.length-1))}):n.attr("name",n.data("name")),e.removeClass("hidden"),a.append(e)}),n.find(".merchant-metabox-field-repeater-remove").on("click",function(e){e.preventDefault(),d(this).closest("li").remove()})}),m.find(".merchant-metabox-field-uploads")),o=(i.length&&i.each(function(){var n,a,t=d(this).find("ul");t.sortable({axis:"y",cursor:"move",helper:"original",handle:".merchant-metabox-field-uploads-move"}),i.find(".merchant-metabox-field-uploads-add").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var e=d(this).parent().find("ul"),t=e.find("li"),n=t.first().clone(!0);n.find("input").each(function(){d(this).attr("name",d(this).data("name").replace("0",t.length))}),n.removeClass("hidden"),e.append(n)}),i.find(".merchant-metabox-field-uploads-upload").on("click",function(e){e.preventDefault(),(a=d(this).closest("li").find(" > input")).attr("name").length&&(n&&n.options.library.type===t.data("library")?n.open():(n=window.wp.media({library:{type:t.data("library")||"image"}}).open()).on("select",function(){var e=n.state().get("selection").first().toJSON();a.val(e.url)}))}),i.find(".merchant-metabox-field-uploads-thumbnail-upload").on("click",function(e){e.preventDefault(),(a=d(this).parent().find("input")).attr("name").length&&(n&&"image"===n.options.library.type?n.open():(n=window.wp.media({library:{type:"image"}}).open()).on("select",function(){var e=n.state().get("selection").first().toJSON(),t=a.parent();a.val(e.id),t.find("span").hide(),t.find("img").remove(),t.find(".merchant-metabox-field-uploads-thumbnail-remove").show(),t.find(".merchant-metabox-field-uploads-thumbnail-upload").append(d("<img>").attr({src:e.url}))}))}),i.find(".merchant-metabox-field-uploads-thumbnail-remove").on("click",function(e){e.preventDefault();e=d(this).parent();e.find("span").show(),e.find("img").remove(),e.find("input").val(""),e.find(".merchant-metabox-field-uploads-thumbnail-remove").hide()}),i.find(".merchant-metabox-field-uploads-remove").on("click",function(e){e.preventDefault(),d(this).closest("li").remove()})}),m.find(".merchant-metabox-field-size-chart")),t=(o.length&&(o.on("multidimensional",function(e,t){(t||o).find("input").each(function(){var e=d(this),t=Math.max(0,e.closest("li").index()-1),n=Math.max(0,e.closest("tr").index()-1),e=Math.max(0,e.closest("td").index());this.name=this.name.replace(/(\[\d+\])\[sizes\](\[\d+\])(\[\d+\])/,"["+t+"][sizes]["+n+"]["+e+"]"),this.name=this.name.replace(/(\[\d+\])\[name\]/,"["+t+"][name]")})}),o.each(function(){var t=d(this).find("ul");o.on("click",".merchant-add",function(e){e.preventDefault();e=t.find("li").first().clone(!0);e.find("input").each(function(){d(this).attr("name",d(this).data("name")),d(this).removeAttr("data-name")}),e.removeClass("hidden"),t.append(e),o.trigger("multidimensional",[e])}),o.on("click",".merchant-add-col",function(e){e.preventDefault();var e=d(this).closest("td"),t=d(this).closest("table");d(this).closest("tbody").find("tr td:nth-child("+(e.index()+1)+")").each(function(){var e=d(this),t=e.clone(!0);t.find("input").val(""),e.after(t)}),o.trigger("multidimensional",[t])}),o.on("click",".merchant-del-col",function(e){e.preventDefault();var e=d(this).closest("td"),t=d(this).closest("table"),n=d(this).closest("tr").find("td").length,e=d(this).closest("tbody").find("tr td:nth-child("+(e.index()+1)+")");2<n?e.remove():e.find("input").val(""),o.trigger("multidimensional",[t])}),o.on("click",".merchant-add-row",function(e){e.preventDefault();var e=d(this).closest("tr"),t=d(this).closest("table"),n=e.clone(!0);n.find("input").val(""),e.after(n),o.trigger("multidimensional",[t])}),o.on("click",".merchant-del-row",function(e){e.preventDefault();var e=d(this).closest("tr"),t=d(this).closest("table");2<d(this).closest("tbody").find("tr").length?e.remove():e.find("input").val(""),o.trigger("multidimensional",[t])}),o.on("click",".merchant-remove",function(e){e.preventDefault(),d(this).closest("li").remove(),o.trigger("multidimensional")}),o.on("click",".merchant-duplicate",function(e){e.preventDefault();var e=d(this).closest("li"),t=e.clone(!0);e.after(t),o.trigger("multidimensional")})})),d(".merchant-metabox-field-media")),t=(t.length&&t.each(function(){var n,e=d(this),a=e.find(".merchant-metabox-field-media-input"),i=e.find(".merchant-metabox-field-media-preview img"),t=e.find(".merchant-metabox-field-media-upload"),o=e.find(".merchant-metabox-field-media-remove"),r=i.data("placeholder");t.on("click",function(e){e.preventDefault(),n||(n=window.wp.media({library:{type:"image"}})).on("select",function(){var e=n.state().get("selection").first().toJSON(),t=(e&&e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail:e).url;a.val(e.id),i.attr("src",t),o.removeClass("hidden")}),n.open()}),o.on("click",function(e){e.preventDefault(),a.val(""),i.attr("src",r),o.addClass("hidden")})}),d(".merchant-metabox-field-select-ajax")),e=(t.length&&c(t),l(e),(t=(t=e).find(".merchant-range")).length&&t.each(function(){var e=d(this),a=e.find(".merchant-range-input"),i=e.find(".merchant-range-number-input");a.on("change input merchant.range merchant-init.range",function(e){var t=d(this),e=("merchant"===e.type?i:t).val()||0,n=t.attr("min")||0,n=(e-n)/((t.attr("max")||100)-n)*100;d("body").hasClass("rtl")?t.css({background:"linear-gradient(to left, #3858E9 0%, #3858E9 "+n+"%, #ddd "+n+"%, #ddd 100%)"}):t.css({background:"linear-gradient(to right, #3858E9 0%, #3858E9 "+n+"%, #ddd "+n+"%, #ddd 100%)"}),a.val(e),i.val(e)}).trigger("merchant-init.range"),i.on("change input blur",function(){a.val(d(this).val()).trigger("merchant.range")})}),d(".merchant-metabox-field-wc-attributes")),t=(e.length&&e.each(function(){d(this).find("ul").sortable({axis:"y",cursor:"move",helper:"original"})}),d(document).on("merchant-metabox-content-show",function(e,t){var n,t=d(t);t.data("code-editor-initalized")||((n=d(".merchant-metabox-field-code-editor",t)).length&&n.each(function(){var e=d(this).find("textarea"),t=wp.codeEditor.defaultSettings||{};t.codemirror=_.extend({},t.codemirror,{gutters:[]}),wp.codeEditor.initialize(e,t).codemirror.on("keyup",function(e){e.save()})}),t.data("code-editor-initalized",!0))}),m.find("[data-depend-on]")),e=(t.length&&t.each(function(){var t=d(this),e=m.find('[name="'+t.data("depend-on")+'"]');e.data("depend-on")||(e.on("change",function(){var e=m.find('[data-depend-on="'+t.data("depend-on")+'"]');d(this).is(":checked")?e.removeClass("merchant-metabox-field-hidden"):e.addClass("merchant-metabox-field-hidden")}),e.data("depend-on",!0))}),m.find(".merchant-metabox-datetime-field"));e.length&&e.each(function(n){var e=d(this),a=e.find("input"),e=e.data("options")||{},i={locale:"undefined"!=typeof merchant_datepicker_locale?"string"==typeof merchant_datepicker_locale?JSON.parse(merchant_datepicker_locale):merchant_datepicker_locale:{},selectedDates:[a.val()?new Date(a.val()):""],onSelect:function(e){e.date;var t=e.formattedDate;void 0===t&&(e.datepicker.$el.value=""),a.trigger("change"),a.trigger("change.merchant-datepicker",[t,a,i,n])}};e.buttons=["clear"],void 0!==e.minDate&&"today"===e.minDate&&(e.minDate=new Date,void 0!==e.timeZone)&&""!==e.timeZone&&(e.minDate=new Date(e.minDate.toLocaleString("en-US",{timeZone:e.timeZone}))),i=Object.assign(i,e),new AirDatepicker(a[0],i),a.attr("readonly",!0)}),d(document).on("click",".merchant-metabox-color-field .merchant-color-picker",function(e){e.preventDefault(),e.stopPropagation();var t=d(this),n=t.closest(".merchant-metabox-color-field").find(".merchant-color-input"),a=t.data("pickr");if(a)a.setColor(n.val()),a.show();else try{var i=d("body,html");i.addClass("merchant-height-auto"),(a=new Pickr({el:t.get(0),container:t.parent().get(0),theme:"merchant",appClass:"merchant-pcr-app",default:n.val()||t.data("default-color")||"#212121",swatches:["#000000","#F44336","#E91E63","#673AB7","#03A9F4","#8BC34A","#FFEB3B","#FFC107","#FFFFFF"],sliders:"h",useAsButton:!0,position:"bottom-start",components:{hue:!0,preview:!0,opacity:!0,interaction:{input:!0,clear:!0}},i18n:{"btn:clear":"Default"}})).on("change",function(e){e=(1===e.a?(a.setColorRepresentation("HEX"),e.toHEXA()):(a.setColorRepresentation("RGBA"),e.toRGBA())).toString(0);t.css({"background-color":e}),n.val()!==e&&n.val(e).trigger("change")}),a.on("clear",function(){var e=t.data("default-color");e?a.setColor(e):(t.css({"background-color":"white"}),n.val(""))}),a.on("hide",function(){i.removeClass("merchant-height-auto")}),t.data("pickr",a),setTimeout(function(){a.show()},200)}catch(e){console.error("Error creating Pickr:",e)}}),d(document).on("change keyup",".merchant-metabox-color-field .merchant-color-input",function(){var e=d(this),t=e.siblings(".merchant-color-picker"),e=e.val();t.css({"background-color":e})});var r=m.find("[data-conditions]");r.length&&((t=function(){r.each(function(){var e=d(this),t=e.data("conditions");t&&t.terms&&((e=>{for(var t=e.relation||"AND",n=[],a=0;a<e.terms.length;a++){var i=e.terms[a],o=m.find('[name="'+i[0]+'"]');if(o.length){var r,l=!1,c=null;switch(c="checkbox"===o.attr("type")?o.is(":checked")?"1":"0":"radio"===o.attr("type")?(r=o.filter(":checked")).length?r.val():"":(o.is("select"),o.val()),i[1]){case"==":l=Array.isArray(c)?-1!==c.indexOf(i[2]):c==i[2];break;case"!=":l=Array.isArray(c)?-1===c.indexOf(i[2]):c!=i[2];break;case"any":var d=i[2].split("|"),l=Array.isArray(c)?c.some(function(e){return-1!==d.indexOf(e)}):-1!==d.indexOf(c);break;case"not_any":var s=i[2].split("|");l=Array.isArray(c)?!c.some(function(e){return-1!==s.indexOf(e)}):-1===s.indexOf(c)}n.push(l)}}return"OR"===t?-1!==n.indexOf(!0):-1===n.indexOf(!1)})(t)?e.removeClass("merchant-metabox-field-hidden"):e.addClass("merchant-metabox-field-hidden"))})})(),m.find("input, select, textarea").on("change",t))})},d(document).ready(function(e){e(".merchant-metabox").merchantMetabox()})})(jQuery);